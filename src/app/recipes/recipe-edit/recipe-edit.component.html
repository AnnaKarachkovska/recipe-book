<form [formGroup]="recipeForm"
      (ngSubmit)="submit()">
  <mat-dialog-content class="form-container">

    <mat-form-field class="form-field">
      <mat-label>Name</mat-label>
      <input matInput
             type="text"
             formControlName="name" />
      <mat-error *ngIf="recipeForm.controls.name.touched && recipeForm.controls.name.errors?.required">
        Name is required.
      </mat-error>
    </mat-form-field>

    <mat-form-field class="form-field">
      <mat-label>Image URL</mat-label>
      <input matInput
             type="text"
             #imgPath
             formControlName="imgPath" />
      <mat-error *ngIf="recipeForm.controls.imgPath.touched && recipeForm.controls.imgPath.errors?.pattern">
        Please enter a valid URL.
      </mat-error>
    </mat-form-field>

    <div *ngIf="imgPath.value"
         class="form-img">
      <!-- TODO: check img-responsive if necessary -->
      <img [src]="imgPath.value"
           width="120"
           class="img-responsive" />
    </div>

    <mat-form-field>
      <mat-label>Description</mat-label>
      <textarea matInput
                type="text"
                rows="6"
                formControlName="desc"></textarea>
    </mat-form-field>

    <div formArrayName="ingredients">
      <div *ngFor="let ingredientControl of ingredientControls; let i = index"
           [formGroupName]="i">

        <mat-form-field class="mr-1">
          <mat-label>Name</mat-label>
          <input matInput
                 type="text"
                 formControlName="name" />
          <mat-error *ngIf="ingredientControl.controls.name.touched && 
                            ingredientControl.controls.name.errors?.required">
            Name is required.
          </mat-error>
          <mat-error *ngIf="ingredientControl.controls.name.touched && 
                            ingredientControl.controls.name.errors?.uniqueIngredient">
            Ingredient was already added.
          </mat-error>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Amount</mat-label>
          <input matInput
                 type="number"
                 formControlName="amount" />
          <mat-error *ngIf="ingredientControl.controls.amount.touched && 
                            ingredientControl.controls.amount.errors?.required">
            Amount is required.
          </mat-error>
          <mat-error *ngIf="ingredientControl.controls.amount.touched && 
                            ingredientControl.controls.amount.errors?.pattern">
            Please enter a valid amount.
          </mat-error>
        </mat-form-field>

        <!-- TODO: add tooltip -->
        <button mat-icon-button
                color="warn"
                aria-label="Icon button with a bin icon"
                type="button"
                (click)="deleteIngredient(i)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>

    <!-- todo: use bootstrap margin and padding classes -->
    <!-- TODO: add tooltip -->
    <div class="row">
      <div class="col-xs-12">
        <button mat-raised-button
                color="primary"
                type="button"
                style="margin-top: 10px"
                (click)="addIngredient()">
          Add ingredient
        </button>
      </div>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-raised-button
            mat-dialog-close
            type="button">
      Cancel
    </button>
    <button mat-raised-button
            type="submit"
            [mat-dialog-close]="true"
            color="primary"
            style="margin-right: 10px"
            [disabled]="!recipeForm.valid">
      Save
    </button>
  </mat-dialog-actions>
</form>